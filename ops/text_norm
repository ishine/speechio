#!/usr/bin/env bash

if [ $# -ne 3 ]; then
    echo "text_norm nj itext output_prefix"
    exit 1;
fi

nj=$1
text=$2
prefix=$3

opts="--to_upper --check_chars --remove_space"

mkdir -p `dirname $prefix`

echo "$0: Partitioning input text"
split -n l/${nj} $text ${prefix}_


echo "$0: Normailzing all partitions in parallel"
for f in `ls ${prefix}_*`; do
    ops/cn_tn.py $opts $f ${f}.out >& ${f}.log &
done
wait

echo "$0: Merging all partition results"
cat ${prefix}_*.out > ${prefix}.txt

echo "$0: Done"

